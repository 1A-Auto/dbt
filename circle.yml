machine:
  post:
    - pyenv global 2.7.9 3.5.0
  hosts:
    database: 127.0.0.1

database:
  override:
    - createdb dbt
    - echo "CREATE ROLE root WITH UNENCRYPTED PASSWORD 'password';" | psql -U postgres
    - echo "ALTER ROLE root WITH LOGIN;" | psql -U postgres
    - echo "GRANT SELECT, UPDATE, INSERT ON ALL TABLES IN SCHEMA dbt.* TO root;" | psql -U postgres
    - echo "GRANT CREATE, CONNECT ON DATABASE dbt TO root;" | psql -U postgres


dependencies:
  pre:
    - sudo pip install --upgrade pip setuptools || true
  override:
    - pip install tox tox-pyenv
    - pyenv local 2.7.9 3.5.0

test:
  override:
    - sudo -i /bin/bash -c 'cd /home/ubuntu/dbt && tox'
  post:
    - mv htmlcov $CIRCLE_ARTIFACTS/
